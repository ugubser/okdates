<div class="participant-form-container" *ngIf="event && !isLoading">
  <div class="event-info">
    <h1>{{ event.title || 'Untitled Event' }}</h1>
    <p *ngIf="event.description">{{ event.description }}</p>
  </div>
  
  <div *ngIf="!showParsedDates">
    <h2>{{ isEditMode ? 'Update Your Availability' : 'Enter Your Availability' }}</h2>
    
    <form [formGroup]="participantForm" (ngSubmit)="parseDates()">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Your Name</mat-label>
        <input matInput formControlName="name" placeholder="Enter your name">
        <mat-error *ngIf="participantForm.get('name')?.hasError('required')">
          Name is required
        </mat-error>
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Available Dates</mat-label>
        <textarea 
          matInput 
          formControlName="availability" 
          placeholder="e.g., June 2-4, July 5"
          rows="4">
        </textarea>
        <mat-hint>
          Enter dates in any format: "June 2,3,4", "06/02, 06/03", "June 2-4", etc.
        </mat-hint>
        <mat-error *ngIf="participantForm.get('availability')?.hasError('required')">
          Availability is required
        </mat-error>
      </mat-form-field>
      
      <div class="form-actions">
        <button 
          mat-raised-button
          color="primary"
          type="submit"
          [disabled]="!participantForm.valid || isParsing">
          {{ isParsing ? 'Processing...' : (isEditMode ? 'Update Dates' : 'Next') }}
        </button>
        
        <button 
          mat-button
          type="button"
          [routerLink]="['/event', eventId, 'view']">
          Cancel
        </button>
      </div>
    </form>
  </div>
  
  <div *ngIf="showParsedDates">
    <h2>Confirm Your Dates</h2>
    
    <div class="parsed-dates-section">
      <div class="ai-powered-badge">
        <mat-icon>smart_toy</mat-icon> AI-Powered Date Recognition
      </div>
      
      <p>We identified the following dates from your input:</p>
      
      <div class="parsed-dates-list">
        <mat-selection-list #datesList>
          <mat-list-option 
            *ngFor="let date of parsedDates; let i = index"
            [selected]="true"
            checkboxPosition="before"
            [attr.data-index]="i">
            <div class="date-option-content">
              <div class="date-display">
                <span class="date-number">{{ i + 1 }}.</span>
                <span class="date-value">{{ formatDate(date.timestamp) }}</span>
              </div>
              <small class="original-text">From: "{{ date.originalText }}"</small>
            </div>
          </mat-list-option>
        </mat-selection-list>
        
        <p class="help-text">
          <mat-icon class="info-icon">info</mat-icon>
          Uncheck any dates that were incorrectly identified. Only checked dates will be submitted.
        </p>
        
        <div class="no-dates" *ngIf="parsedDates.length === 0">
          <p>We couldn't identify any dates from your input. Please go back and try a different format.</p>
          <p class="suggestion">Try formats like "June 15-17", "6/15, 6/16", or "next Monday and Tuesday".</p>
        </div>
      </div>
    </div>
    
    <div class="form-actions">
      <button 
        mat-raised-button
        color="primary"
        (click)="confirmDates()"
        [disabled]="isSubmitting || parsedDates.length === 0">
        {{ isSubmitting ? 'Submitting...' : (isEditMode ? 'Update' : 'Submit') }}
      </button>
      
      <button 
        mat-button
        (click)="backToDateInput()"
        [disabled]="isSubmitting">
        Back
      </button>
    </div>
  </div>
</div>

<div class="loading-container" *ngIf="isLoading">
  <mat-spinner></mat-spinner>
</div>